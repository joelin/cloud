# PaaS平台分析

## 什么是PaaS平台
PaaS(Platform as a Service)是将基础网络设施和计算资源的硬件和应用基础架构（Middleware）以服务的形式提供给用户,PaaS免去了用户搭建硬件网络和开发、运行新应用程所需的软件基础架构投入,为企业简化流程应用的交付、运行和维护提供端到端的完整支持。PaaS为了简化软件的交付并平台化，把应用的运行环境进行统一和固化，只不过从第一代的单语言框架支持，演化为现在的多语言多框架的支持；环境统一的打包方式从特定模式(javapack)演化为现在几乎通用的docker image的模式。可以说PaaS平台依赖于运行环境打包交互的大前提。

Gartner把PaaS分为两类，一类为应用平台即服务APaaS(Application Platform as a Service)，一类为集成平台即服务IPaaS(Integration Platform as a Service)，IPaaS架构在APaaS之上。我们通常说所得PaaS为APaaS，目前大部分企业也主要聚焦在这部分。APaaS主要面向技术方面的支持，IPaaS面向业务方面的支持。

  - APaaS

    * 应用开发
    * 应用原数据管理
    * 数据存储(多种类型)
    * 应用构建(CI)
    * 应用交付(CD)
    * 分布式运行环境/部署(部署架构编排)
    * 应用监控/计量
    * 动态伸缩
    * 应用运维/升级

  - IPaaS

    * 外部业务集成(比如合作伙伴等)
    * 业务监控
    * 业务编排(服务编排)
    * 数据转换、传输等
    * 流程编排(流程引擎)

对比以上列出的功能点，IPaaS相对于APaaS来说相对理想，APaaS更贴合实际情况和企业能够实现的场景。本文主要就PaaS(仅包含APaaS部分)在企业内部如何落地探讨出一套方法论，帮助企业能够理解PaaS，以及其如何帮助企业改进其研发管理、产品交付及管理提供端到端的支持。

## PaaS如何影响IT企业
按照PaaS的定义，其影响IT企业的开发、测试、交互、运维、管理等各个环节，把IT企业的各个环节列出，对比起来看PaaS如何介入这些环节中。如下图，一般IT企业包含大致如下一些环节，根据团队的天然合作模式，把其分为三个阶段：开发阶段、测试阶段、生产运维阶段。下面将分析PaaS如何提供一站式服务来为IT企业提供这三个阶段的端到端的服务。方便理解，从本单位方案、传统方案、PaaS方案三个方面来对这三个阶段进行分析比对。

![2342](images/dev-opt-flow.png)

### 开发阶段

||开发编码|构建|开发环境申请|配置部署/测试|
|----|-------|---|---------|------------|
|本单位方案|开发自主|基本人工|人工分配／配置|应用人工安装配置／测试|
|传统方案|开发自主(对应用有基本的定义规范)|自动化构建平台|平台申请／人工分配／模版配置|应用自动部署平台／测试|
|PaaS方案|开发自主(入口需定义应用原数据信息，此信息一直伴随应用整个生命周期)|无缝对接自动构建|无缝对接IaaS平台的资源申请，并使用标准化的打包运行环境，在应用原数据中定义其环境信息|包含应用原数据信息的自动部署模块／测试|

传统方案中做到极致也就相当于PaaS方案了，只不过传统方案中各个环境的支撑平台相对独立，没有整合在一起，比如版本管理库、自动构建、资源管理平台、自动部署平台等自成一套，它们之间往往以特定接口或者人工对接。而PaaS方案把这些平台的功能整合在了一起，并使用应用原数据把它们无缝串联在一起协作。这样就对IT的各个环境的人员(开发、测试、管理、运维等)提供端到端的支持服务。

### 测试阶段

||发布测试|编译／发布|测试环境申请|配置部署/测试|
|----|-------|---|---------|------------|
|本单位方案|开发打tag提交bugzilla|基本人工|人工分配／配置|应用人工安装配置／测试|
|传统方案|开发打tag发布版本|自动化构建平台|平台申请／人工分配／模版配置|应用自动部署平台／测试|
|PaaS方案|开发打tag发布版本|无缝对接自动构建|无缝对接IaaS平台的资源申请，并使用标准化的打包运行环境，在应用原数据中定义其环境信息|包含应用原数据信息的自动部署模块／测试|

测试阶段于开发阶段很像，一般在互联网类企业会把开发和测试放在一个产品型团队，产品的质量由整个团队负责，而没有把这两个阶段割裂开来。在这三个方案里面里 ，开发／测试阶段的入口都为源码(程序的源码版本库为纽带；传统包含简陋原数据、PaaS包含完整原数据)，如果把这两个阶段完全割裂开，在传统方案案看来，只不过是重复的工作，在定义应用原数据时只需区分开发和测试即可在一个共用的平台里对同一产品进行开发和测试的工作。

### 生产运维阶段

||发布生产|生产环境申请|配置部署|应用健康|伸缩申请|配置部署|
|----|-------|---|---------|------------|
|本单位方案|CM发布应用目标版本到FTP服务器|提交部署架构需求／人工分配资源|人工配置／部署应用|监控平台/日志人工查询|根据需求提伸缩资源申请／人工分配资源／提交伸缩方案|人工配置／实施伸缩|
|传统方案|CM发布应用目标版本到版本库|提交部署架构需求／人工分配资源／根据应用要求初始化运行环境|自动部署平台推送应用到目标环境，上线应用|统一监控(全方位)／统一日志平台|提交部署架构需求／人工分配资源／根据应用要求初始化运行环境|自动部署平台推送应用到目标环境，上线应用|
|PaaS方案|CM发布应用目标版本到版本库|填写应用生产的原数据信息(部署信息、关系、配置文件、伸缩规则等等)|调度器根据原数据自动部署应用|结合应用原数据的统一全方位监控／统一日志查询模块|包含应用原数据信息的自动部署模块／测试|调度器根据监控数据和伸缩规则自动化对应用进行弹性伸缩操作|

对于生产运维来说，应用的健康是至关重要的。当然不仅只有生产运维有应用的健康阶段，开发和测试也有，同样的功能模块一样可以应用在开发和测试阶段，只不过在开发测试阶段没有显示的表明。而在生产环境中，PaaS整合了传统方案的自动部署平台、监控平台、日志平台、应用版本仓库，PaaS为了进一步快速的响应需求，把应用的运行环境从模版化改为容器化并与应用打包在一起交付的方式。从而达到了更快速的应用部署及启动来响应需求。

### PaaS功能梳理

通过以上的比较，可以形象的理解PaaS平台，结合业界的方案、开源产品简单梳理其功能包含以下几点

* 应用原数据管理
    需开发，其为各种平台对接整合的纽带
* 应用源码版本库(可选)
    做到CI／CD的PaaS平台需要，为应用交付的主要内容；开源:git svn等
* CI/CD支持(可选)
    自动构建工具集成，通过应用原数据进行对接；开源:jenkins、仓库等
* 应用运行环境的打包(可选)
    带运行环境的产品交付方式，通用采用docker，可以自定义或其它； 开源: docker及仓库 garden等
* 应用配置的服务化

* 服务的发现及自注册

* 资源的抽象及管理
    对物理资源的抽象及调度，可以池化管理；开源：mesos swarm kubernates cloudfoundry等
* 应用调度(自动部署)
    由于容器化后，运行环境与应用一起交付，所以无需部署平台，只需调度容器即可。根据原数据对应用(带运行环境的打包整体)的调度，一般与资源的抽象及管理层融合在一起，开源 mesos->marathon swarm->swarm kubernates-> kubernates cloudfoundry->cloudfoundry
* 监控
    主机监控、容器的监控、应用监控、业务监控等各项监控结合应用原数据信息进行整合，并为调度、伸缩模块提供数据支撑。 开源: zabbix nagios
* 日志
    分布式系统的日志归集和分析由专有平台来处理，PaaS可以整合这些开源平台来处理其上分布式系统的日志查询和分析的工作。开源: ELK(Elastic + Logstash + Kibana) EFK(Elastic + Fluentd + Kibana)
* 弹性伸缩策略引擎
    根据应用原数据配置的规则，弹性引擎需要实时获取监控的数据并根据规则匹配，如果匹配上则按照规则触发弹性伸缩的动作。无开源


## 方案介绍
   业界方案基本围绕以上介绍的几个开源产品来封装，下面就以不同厂商提供的这几套开源产品进行介绍,为了简化，我们把开发和测试阶段的集成称之为CI/CD支持，后面阶段不变。


|方案|CI/CD支持|发布生产|生产环境申请|配置部署|应用健康|伸缩申请|弹性伸缩策略|
|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|
|openshift(redhat/kubernates)|简单支持|容器仓库|原数据|根据原数据自动调度部署|容器化监控方案／EFK|kubernates支持|-|
|dcos(daocloud/swarm)|简单支持|容器仓库|原数据|根据原数据自动调度部署|容器化监控方案／EFK|简陋|
|dcos(kt/mesos)|不支持|容器仓库|原数据|根据原数据自动调度部署|容器化监控方案／ELK|简陋|

### 测试比较

### 互联网案例


## 企业决策

### 工作范围确定
 对于上面介绍的方案及与企业自身的比较，首先需要决策现阶段PaaS整合哪些环节？CI／CD和产品的生产运维？还是仅产品的生产运维？不同的团队、部门怎么在这个平台上协作？不同的阶段涉及的人员和将来的协作方式都不一样，同样平台的工作量也不一样。

### 方案选型确定
 其次是对方案的评估，三种方案的选型及倾向？

### 应用集成方式确定

## 应用的要求



## 参考
- http://www.gartner.com/it-glossary/platform-as-a-service-paas
